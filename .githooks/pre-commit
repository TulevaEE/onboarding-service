#!/bin/bash

echo "üîç Running tests and verifying coverage..."

spinner() {
    local pid=$1
    local delay=0.1
    local spinstr='|/-\'
    echo -n " "
    while [ "$(ps a | awk '{print $1}' | grep $pid)" ]; do
        local temp=${spinstr#?}
        printf " [%c]  " "$spinstr"
        local spinstr=$temp${spinstr%"$temp"}
        sleep $delay
        printf "\b\b\b\b\b\b"
    done
    printf "    \b\b\b\b"
}

#echo "üì¶ Stashing uncommitted changes..."
#git stash -q --keep-index || true

echo "‚ú® Checking Spotless formatting..."
if ! ./gradlew spotlessCheck --no-daemon --quiet; then
    echo "‚ùå Spotless formatting check failed."
    echo "   Run './gradlew spotlessApply' to fix formatting, then try again."
    exit 1
fi
echo "‚úÖ Spotless formatting check passed."

exit 0
